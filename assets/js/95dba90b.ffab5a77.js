"use strict";(self.webpackChunkelfsquad=self.webpackChunkelfsquad||[]).push([[12391],{54918:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>l,frontMatter:()=>o,metadata:()=>c,toc:()=>d});var i=t(74848),s=t(28453);const o={title:"Code authentication",sidebar_position:3},a=void 0,c={id:"apis/authentication/code",title:"Code authentication",description:"Before You Begin",source:"@site/docs/apis/authentication/code.md",sourceDirName:"apis/authentication",slug:"/apis/authentication/code",permalink:"/docs/apis/authentication/code",draft:!1,unlisted:!1,editUrl:"https://github.com/elfsquad/docs/edit/main/docs/apis/authentication/code.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Code authentication",sidebar_position:3},sidebar:"apiSidebar",previous:{title:"Client Credentials",permalink:"/docs/apis/authentication/client-credentials"},next:{title:"Data API",permalink:"/docs/apis/data-api"}},r={},d=[{value:"Before You Begin",id:"before-you-begin",level:2},{value:"Using the <code>@elfsquad/authentication</code> package",id:"using-the-elfsquadauthentication-package",level:2},{value:"Using custom code",id:"using-custom-code",level:2},{value:"Step 1: Redirecting the user",id:"step-1-redirecting-the-user",level:3},{value:"Step 2: Extracting the code",id:"step-2-extracting-the-code",level:3},{value:"Step 3: Exchanging the code",id:"step-3-exchanging-the-code",level:3},{value:"Step 4: Refreshing the token",id:"step-4-refreshing-the-token",level:3}];function h(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"before-you-begin",children:"Before You Begin"}),"\n",(0,i.jsxs)(n.p,{children:["To create a new OpenId client integration, navigate to the Integrations\npage at\n",(0,i.jsx)(n.a,{href:"https://ems.elfsquad.io/integration",children:"ems.elfsquad.io/integration"}),". Once\nthere, you can proceed with setting up the integration."]}),"\n",(0,i.jsx)(n.p,{children:"After successful setup, an OpenId client will be created, and you can\nconfigure it by accessing its settings."}),"\n",(0,i.jsx)(n.p,{children:"Ensure that the 'Token auth method' is set to 'None', and the 'Grant\ntype' is set to 'Code'. These settings are essential for successful\nauthentication."}),"\n",(0,i.jsx)(n.p,{children:"Be sure to take note of the client ID as it will be needed later. For\ncode authentication, you can disregard the client secret."}),"\n",(0,i.jsx)(n.p,{children:"Finally, include a redirect URL where the user will be directed after a\nsuccessful login."}),"\n",(0,i.jsxs)(n.h2,{id:"using-the-elfsquadauthentication-package",children:["Using the ",(0,i.jsx)(n.code,{children:"@elfsquad/authentication"})," package"]}),"\n",(0,i.jsx)(n.p,{children:"To make it easier for you to connect with Elfsquad, we made a package\nthat handles the authentication for you."}),"\n",(0,i.jsx)(n.p,{children:"We recommend you to use this package. It saves you time & you are\nguaranteed to have a stable interface that is updated when new\nfunctionalities are introduced."}),"\n",(0,i.jsxs)(n.p,{children:["More information about how to integrate with this package,\n",(0,i.jsx)(n.a,{href:"https://github.com/elfsquad/authentication",children:"can be found here"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"using-custom-code",children:"Using custom code"}),"\n",(0,i.jsx)(n.p,{children:"At some point in the UI of your app, you will need to get the end user\nto log in, in order to gain consent to access Elfsquad's resources on\nthe end user\u2019s behalf."}),"\n",(0,i.jsx)(n.p,{children:"You can do this when the end user opens the app, or you may wait until\nyour app actually needs to access Elfsquad's resources."}),"\n",(0,i.jsx)(n.h3,{id:"step-1-redirecting-the-user",children:"Step 1: Redirecting the user"}),"\n",(0,i.jsxs)(n.p,{children:["In either case, you will have to redirect the end user to the\n",(0,i.jsx)(n.code,{children:"oauth2/auth"})," endpoint in their browser. You could do this by\nproviding a link for the end user:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'<a href="https://login.elfsquad.io/oauth2/auth?client_id={CLIENT_ID}&redirect_uri={REDIRECT_URL}&response_type=code&scope=Elfskot.Api%20offline_access%20openid%20profile&response_mode=fragment">\n    Click here to login\n</a>\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Replace the ",(0,i.jsx)(n.code,{children:"{CLIENT_ID}"})," and ",(0,i.jsx)(n.code,{children:"{REDIRECT_URL}"})," values in the example\nbelow with those specific to your OpenId Client."]}),"\n",(0,i.jsx)(n.p,{children:"Clicking on the link will take the end user to the Elfsquad login page.\nAfter the end user has succesfully logged in with valid credentials, the\nend user will be redirected back to your redirect url with the access\ntoken included as a fragment of the URL."}),"\n",(0,i.jsx)(n.h3,{id:"step-2-extracting-the-code",children:"Step 2: Extracting the code"}),"\n",(0,i.jsxs)(n.p,{children:["After completing the login, the user will be redirected back to the\nredirect URL. The user will be redirected to the URL with a ",(0,i.jsx)(n.code,{children:"code"})," in\nthe URL. This code can be exchanged for an access token."]}),"\n",(0,i.jsx)(n.p,{children:"An example of the redirect URL is shown below:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"https://myapp.com/callback#scope=Elfskot.Api%20offline_access%20openid%20profile&code=123&state=abc\n"})}),"\n",(0,i.jsx)(n.p,{children:"You will need to extract the code from this URL."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const reg = new RegExp('#code=(.*?)&');\nconst code = reg.exec(window.location.href)[1]\nalert(\"your code is : \" + code);\n"})}),"\n",(0,i.jsx)(n.h3,{id:"step-3-exchanging-the-code",children:"Step 3: Exchanging the code"}),"\n",(0,i.jsx)(n.p,{children:"The extracted code can be exchanged for an access token. This access\ntoken can be used to make requests on behalf of the user."}),"\n",(0,i.jsxs)(n.p,{children:["The token can be exchanged by sending a POST request to the\n",(0,i.jsx)(n.code,{children:"https://login.elfsquad.io/oauth2/token"})," endpoint."]}),"\n",(0,i.jsx)(n.p,{children:"The request requires a couple pieces of information in the body. An\nexample is shown below."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "grant_type": "authorization_code",\n    "client_id" {CLIENT_ID},\n    "redirect_uri": {REDIRECT_URI},\n    "code": {CODE},\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"This will return a response with the following body:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "access_token": "123",\n    "expires_in" 3600,\n    "id_token": "abc",\n    "refresh_token": "xyz"\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"step-4-refreshing-the-token",children:"Step 4: Refreshing the token"}),"\n",(0,i.jsx)(n.p,{children:"By default, the token returned by the previous API call is valid for\n3600 seconds (60 minutes). After this, any API call made with the token,\nwill return a 401 unauthorized status code."}),"\n",(0,i.jsx)(n.p,{children:"This can be fixed by making use of the refresh token returned in the\nprevious request. This token is valid for 30 days and can be used to\nretrieve a fresh access token."}),"\n",(0,i.jsxs)(n.p,{children:["For this request, you will need to use the ",(0,i.jsx)(n.code,{children:"oauth2/token"})," endpoint\nagain, with the following body:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "grant_type": "refresh_token",\n    "client_id": {CLIENT_ID},\n    "redirect_uri": {REDIRECT_URI},\n    "refresh_token" {REFRESH_TOKEN}\n}\n'})})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);