"use strict";(self.webpackChunkelfsquad=self.webpackChunkelfsquad||[]).push([[539],{9825:function(t,e,n){n.r(e),n.d(e,{frontMatter:function(){return u},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return c},default:function(){return m}});var o=n(2122),r=n(9756),a=(n(7294),n(3905)),i=["components"],u={slug:"tutorial - custom configurator in Angular",title:"Tutorial - Custom configurator in Angular",author:"Johannes Heesterman",author_title:"Lead Software Engineer @ Elfsquad",author_url:"https://github.com/johannesheesterman",author_image_url:"https://avatars.githubusercontent.com/u/7443666?v=4",tags:["angular","configurator"]},l=void 0,p={permalink:"/blog/tutorial - custom configurator in Angular",editUrl:"https://github.com/elfsquad/docs/edit/master/blog/2020-11-24-custom-configurator-angular.md",source:"@site/blog/2020-11-24-custom-configurator-angular.md",title:"Tutorial - Custom configurator in Angular",description:"Custom configurator in Angular",date:"2020-11-24T00:00:00.000Z",formattedDate:"November 24, 2020",tags:[{label:"angular",permalink:"/blog/tags/angular"},{label:"configurator",permalink:"/blog/tags/configurator"}],readingTime:8.345,truncated:!1,prevItem:{title:"Tutorial - Custom configurator",permalink:"/blog/tutorial - custom configurator"}},c=[{value:"Custom configurator in Angular",id:"custom-configurator-in-angular",children:[{value:"Setup the Angular project",id:"setup-the-angular-project",children:[]},{value:"Product overview page",id:"product-overview-page",children:[]},{value:"Configurator page",id:"configurator-page",children:[]},{value:"Checkout page",id:"checkout-page",children:[]},{value:"Result",id:"result",children:[]}]}],s={toc:c};function m(t){var e=t.components,u=(0,r.Z)(t,i);return(0,a.kt)("wrapper",(0,o.Z)({},s,u,{components:e,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"custom-configurator-in-angular"},"Custom configurator in Angular"),(0,a.kt)("p",null,"In this tutorial I will provide a quick overview of how to implement your own customer-facing configurator in Angular."),(0,a.kt)("p",null,"The resulting project is also available at github ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/Elfsquad/tutorials-angular-configurator"},"https://github.com/Elfsquad/tutorials-angular-configurator"),"."),(0,a.kt)("p",null,"If you are not familiar with Angular you should follow the Getting Started guide at ",(0,a.kt)("a",{parentName:"p",href:"https://angular.io/start"},"https://angular.io/start "),"."),(0,a.kt)("h3",{id:"setup-the-angular-project"},"Setup the Angular project"),(0,a.kt)("p",null,"Create a new Angular project using your terminal"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"ng new BrightwaterConfigurator --routing=true --style=css --skipTests=true\n")),(0,a.kt)("p",null,"In the index.html file add a reference to the Elfskot JS library and some basic CSS."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<script src="https://elfskot.azureedge.net/elfskot-v0.1.js"><\/script>\n')),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<style>\n    body{\n      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";\n    }\n</style>\n')),(0,a.kt)("p",null,"Remove all the contents of the app.component.html file but keep the router-outlet element"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},"<router-outlet></router-outlet>\n")),(0,a.kt)("h3",{id:"product-overview-page"},"Product overview page"),(0,a.kt)("p",null,"First we create a component that will hold our product overview page using the ",(0,a.kt)("em",{parentName:"p"},"ng generate")," command"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"ng generate component Products\n")),(0,a.kt)("h4",{id:"product-overview-route"},"Product overview route"),(0,a.kt)("p",null,"Now that we have the Products component, we should register it as the base route. In the ",(0,a.kt)("em",{parentName:"p"},"app-routing-module.ts")," file add a route to the Products component"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport { ProductsComponent } from './products/products.component';\n\nconst routes: Routes = [\n  {  path: '', component: ProductsComponent } // <-- Route to the Products component\n];\n\n@NgModule({\n  imports: [RouterModule.forRoot(routes)],\n  exports: [RouterModule]\n})\nexport class AppRoutingModule { }\n")),(0,a.kt)("h4",{id:"product-overview-component"},"Product overview component"),(0,a.kt)("p",null,"The first step to creating our product overview is the retrieve a list of all available configuration models.\nIn the ",(0,a.kt)("em",{parentName:"p"},"ngOnInit")," method of the ",(0,a.kt)("em",{parentName:"p"},"products.component.ts")," file call the ",(0,a.kt)("em",{parentName:"p"},"Elfskot.configurator.getConfigurationModels")," method"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Component, OnInit } from '@angular/core';\n\ndeclare var Elfskot;\n\n@Component({\n  selector: 'app-products',\n  templateUrl: './products.component.html',\n  styleUrls: ['./products.component.css']\n})\nexport class ProductsComponent implements OnInit {\n\n  products: any[] = [];\n\n  constructor() { }\n\n  ngOnInit() {\n    Elfskot.configurator.getConfigurationModels('en', (productOverview) => {\n      this.products = productOverview.features;\n    });\n  }\n\n}\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("em",{parentName:"p"},"Elfskot.configurator.getConfigurationModels")," method takes 2 parameters"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The preferred language ISO"),(0,a.kt)("li",{parentName:"ul"},"A callback function")),(0,a.kt)("p",null,"The callback function provides a object, with different elements, that can be used to setup your product selection page. For now we will only be using the features."),(0,a.kt)("p",null,"Next we add HTML and CSS to the ",(0,a.kt)("em",{parentName:"p"},"ProductsComponent"),"."),(0,a.kt)("p",null,"In the ",(0,a.kt)("em",{parentName:"p"},"products.component.html")," file add"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<div class="product-overview">\n  <div *ngFor="let product of products" class="product-card" [routerLink]="[\'configure\', product.featureModelId]">\n    <img [src]="product.imageUrl" />\n    <h3 [innerHTML]="product.description"></h3>\n  </div>\n</div>\n')),(0,a.kt)("p",null,"In the ",(0,a.kt)("em",{parentName:"p"},"products.component.css")," file add"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-css"},".product-overview {\n    display: flex;\n    flex-direction: row;\n    flex-wrap: wrap;\n}\n.product-card {\n    box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);\n    transition: all 0.3s cubic-bezier(.25,.8,.25,1);\n    cursor: pointer;\n    margin:12px;\n    width:320px;\n}\n    .product-card h3{\n        padding:12px;\n    }\n    .product-card img{\n        width:100%;\n        height:auto;\n    }\n\n.product-card:hover {\n    box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);\n}\n")),(0,a.kt)("p",null,"If we were to run the Angular project now we would get the following result:"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Product overview",src:n(4156).Z})),(0,a.kt)("h3",{id:"configurator-page"},"Configurator page"),(0,a.kt)("p",null,"Now that we have a product selection page, we can proceed to build the actual configurator. "),(0,a.kt)("p",null,"First add a ConfiguratorComponent"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"ng generate component Configurator\n")),(0,a.kt)("p",null,"Register a configuration route in the ",(0,a.kt)("em",{parentName:"p"},"app-routing.module.ts")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport { ProductsComponent } from './products/products.component';\nimport { ConfiguratorComponent } from './configurator/configurator.component';\n\nconst routes: Routes = [\n  {  path: '', component: ProductsComponent },\n  {  path: 'configure/:id', component: ConfiguratorComponent } // <-- Route to the Configurator component\n];\n\n@NgModule({\n  imports: [RouterModule.forRoot(routes)],\n  exports: [RouterModule]\n})\nexport class AppRoutingModule { }\n")),(0,a.kt)("p",null,"In the configure route we added a ",(0,a.kt)("em",{parentName:"p"},"id")," parameter that will be used to hold the identifier of the selected configuration model in the product overview page."),(0,a.kt)("h4",{id:"configurator-component"},"Configurator Component"),(0,a.kt)("p",null,"First add a declaration for the global Elfskot variable. Your ",(0,a.kt)("em",{parentName:"p"},"configurator.component.ts")," file should look like this"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Component, OnInit } from '@angular/core';\n\ndeclare var Elfskot;\n\n@Component({\n  selector: 'app-configurator',\n  templateUrl: './configurator.component.html',\n  styleUrls: ['./configurator.component.css']\n})\nexport class ConfiguratorComponent implements OnInit {\n\n  constructor() { }\n\n  ngOnInit() {\n  }\n\n}\n")),(0,a.kt)("p",null,"Add the reference to the current route to the constructor and a private field to hold the configuration object we will retrieve later."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"private configuration = null;\n\nconstructor(private route: ActivatedRoute) { }\n")),(0,a.kt)("p",null,"Now in the ",(0,a.kt)("em",{parentName:"p"},"ngOnInit")," we will add a listener for parameter changes in the route. If the route changes  we will start a new configuration session"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"ngOnInit() {\n    this.route.params.subscribe((params) => {\n      this.startNewSession(params['id']);\n    });\n}\n")),(0,a.kt)("p",null,"Add a private method to start a new configuration session"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"private startNewSession(id: string) : void {\n    Elfskot.configurator.startNewConfiguration(id, 'en', (configuration) => {\n        this.configuration = configuration;\n    });\n}\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("em",{parentName:"p"},"Elfskot.configurator.startNewConfiguration")," method takes 3 parameters"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The identifier of the configuration model"),(0,a.kt)("li",{parentName:"ul"},"A language iso"),(0,a.kt)("li",{parentName:"ul"},"Callback method that takes the new configuration object")),(0,a.kt)("p",null,"The resulting configuration object contains many different fields that can be used to construct the interface of your configurator. In this tutorial we will be mainly focused on the ",(0,a.kt)("em",{parentName:"p"},"totalPrice")," and ",(0,a.kt)("em",{parentName:"p"},"steps")," fields."),(0,a.kt)("p",null,"The ",(0,a.kt)("em",{parentName:"p"},"steps")," field should be used to construct the user interface. The ",(0,a.kt)("em",{parentName:"p"},"steps")," are structured as follows"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Steps",(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre"},"* Title (optional)\n* Type (0 = Hotspots, 1 = 3D)\n* Features\n    * Description\n    * UnitPrice\n    * TotalPrice\n    * Type (0 = Optional, 1 = Mandatory, 2 = Alternative, 3 = Or)\n    * Features (Children of the current feature, recursive)\n            * ..\n    * ...\n* ...\n")))),(0,a.kt)("p",null,"To listen to changes in the configuration session we can add a configurationUpdated event listener in the ",(0,a.kt)("em",{parentName:"p"},"ngOnInit")," function"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"ngOnInit() {\n    this.route.params.subscribe((params) => {\n      this.startNewSession(params['id']);\n    });\n\n    Elfskot.on('configurationUpdated', (configuration) => {\n      this.configuration = configuration;\n    });\n}\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("em",{parentName:"p"},"configurationUpdated")," event returns the entire updated configuration object including updated prices etc."),(0,a.kt)("p",null,"The complete ConfiguratorComponent should look like this"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute } from '@angular/router';\n\ndeclare var Elfskot;\n\n@Component({\n  selector: 'app-configurator',\n  templateUrl: './configurator.component.html',\n  styleUrls: ['./configurator.component.css']\n})\nexport class ConfiguratorComponent implements OnInit {\n\n  private configuration = null;\n\n  constructor(private route: ActivatedRoute) { }\n\n  ngOnInit() {\n    this.route.params.subscribe((params) => {\n      this.startNewSession(params['id']);\n    });\n\n    Elfskot.on('configurationUpdated', (configuration) => {\n      this.configuration = configuration;\n    });\n  }\n\n  private startNewSession(id: string) : void {\n    Elfskot.configurator.startNewConfiguration(id, 'en', (configuration) => {\n      this.configuration = configuration;\n    });\n  }\n\n}\n")),(0,a.kt)("h5",{id:"configurator-option-component"},"Configurator Option component"),(0,a.kt)("p",null,"Because of the recursive nature of the ",(0,a.kt)("em",{parentName:"p"},"Steps -> Features -> Features")," structure we will need to create a new Angular component to hold the options of the configurator."),(0,a.kt)("p",null,"Add a ConfiguratorOption component to the project"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"ng generate component ConfiguratorOption\n")),(0,a.kt)("p",null,"The ConfiguratorOption component will take a Feature object as input and act on all the user interactions for this feature."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Component, OnInit, Input } from '@angular/core';\n\ndeclare var Elfskot;\n\n@Component({\n  selector: 'app-configurator-option',\n  templateUrl: './configurator-option.component.html',\n  styleUrls: ['./configurator-option.component.css']\n})\nexport class ConfiguratorOptionComponent implements OnInit {\n\n  @Input('feature') feature;\n\n  constructor() { }\n\n  ngOnInit() {\n  }\n\n  toggle(): void {\n    let value = 1;\n    if (this.feature.isSelected) {\n      value = 0;\n    }\n\n    Elfskot.configurator.updateRequirement(this.feature.id, value);\n  }\n}\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("em",{parentName:"p"},"toggle")," function calls ",(0,a.kt)("em",{parentName:"p"},"Elfskot.configurator.updateRequirement")," which takes 2 parameters"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The identifier of the selected element"),(0,a.kt)("li",{parentName:"ul"},"A value, which should be a number")),(0,a.kt)("p",null,"In the ",(0,a.kt)("em",{parentName:"p"},"configurator-option.component.html")," file we define a template that can act on the different types of features"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<div class="configurator-option" *ngIf="feature.type != 1 || feature.features.length > 0">\n  <b *ngIf="feature.type == 1" [innerHTML]="feature.description"></b>\n\n  <label *ngIf="feature.type == 0 || feature.type == 3">\n    <img [src]="feature.imageUrl" />\n    <input type="checkbox" [checked]="feature.isSelected" (change)="toggle()" />\n    <span [innerHTML]="feature.description"></span>\n    <small>{{feature.unitPrice}}</small>\n  </label>\n\n  <label *ngIf="feature.type == 2">\n    <img [src]="feature.imageUrl" />\n    <input type="radio" [checked]="feature.isSelected" (change)="toggle()" />\n    <span [innerHTML]="feature.description"></span>\n    <small>{{feature.unitPrice}}</small>\n  </label>\n  \n  <app-configurator-option *ngFor="let child of feature.features" [feature]="child"></app-configurator-option>\n</div>\n')),(0,a.kt)("p",null,"In the ",(0,a.kt)("em",{parentName:"p"},"configurator-option.component.css")," file add some CSS to aid in displaying the structure of the configuration model"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-css"},"img {\n    width:24px;\n    height:24px;\n    border-radius: 50%;\n}\n\nlabel{\n    display: flex;\n    align-items: center;\n    cursor: pointer;\n}\n\n.configurator-option{\n    padding-left:32px;\n    margin-bottom: 6px;\n    position: relative;\n}\n\nsmall {\n    font-style: italic;\n    font-size: 10px;\n    color: #f00;\n}\n")),(0,a.kt)("h4",{id:"add-the-configuratoroption-component-to-the-configuratorcomponent"},"Add the ConfiguratorOption component to the ConfiguratorComponent"),(0,a.kt)("p",null,"Now that we have the ConfiguratorOption component defined, we can add it to the configurator page."),(0,a.kt)("p",null,"In the ",(0,a.kt)("em",{parentName:"p"},"configurator.component.html")," we create a loop that will iterate over the different steps of the configuration model and call the ConfiguratorOption component for each rootfeature in the step."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<div *ngIf="configuration" class="configurator-container">\n\n    <h2 [innerHTML]="configuration.root.description"></h2>\n  \n    <ng-container *ngFor="let step of configuration.steps">\n  \n      <app-configurator-option *ngFor="let feature of step.features" [feature]="feature"></app-configurator-option>\n  \n    </ng-container>\n    \n    <h3>Total price <small>{{configuration.totalPriceExclVat}}</small></h3>\n  \n    <button routerLink="/checkout">Request quote</button>\n</div>\n')),(0,a.kt)("p",null,"If we were to open a configuration now it would look like this"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Configurator",src:n(7089).Z})),(0,a.kt)("h3",{id:"checkout-page"},"Checkout page"),(0,a.kt)("p",null,"Now that we are able to configure a product, we can go ahead and request a quotation."),(0,a.kt)("p",null,"Initialize the CheckoutComponent"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"ng generate component Checkout\n")),(0,a.kt)("p",null,"And register a route to the CheckoutComponent in the ",(0,a.kt)("em",{parentName:"p"},"app-routing.module.ts")," file"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport { ProductsComponent } from './products/products.component';\nimport { ConfiguratorComponent } from './configurator/configurator.component';\nimport { CheckoutComponent } from './checkout/checkout.component';\n\nconst routes: Routes = [\n  {  path: '', component: ProductsComponent },\n  {  path: 'configure/:id', component: ConfiguratorComponent },\n  {  path: 'checkout', component: CheckoutComponent } // <-- Route to the checkout page\n];\n\n@NgModule({\n  imports: [RouterModule.forRoot(routes)],\n  exports: [RouterModule]\n})\nexport class AppRoutingModule { }\n")),(0,a.kt)("p",null,"In the ",(0,a.kt)("em",{parentName:"p"},"checkout.component.ts")," file we create a function that will call the ",(0,a.kt)("em",{parentName:"p"},"Elfskot.configurator.requestQuote")," function and handle its response."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-typescript"},"import { Component, OnInit, ViewChild } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { NgForm } from '@angular/forms';\n\ndeclare var Elfskot;\n\n@Component({\n  selector: 'app-checkout',\n  templateUrl: './checkout.component.html',\n  styleUrls: ['./checkout.component.css']\n})\nexport class CheckoutComponent implements OnInit {\n \n  configuration = null;\n  isSubmitted = false;\n  \n  constructor(private router: Router) { }\n\n  ngOnInit() {\n    if (!Elfskot.configurator.configuration){\n      this.router.navigateByUrl('/');\n      return;\n    }\n\n    this.configuration = Elfskot.configurator.configuration;\n  }\n\n  requestQuote(model) {\n    Elfskot.configurator.requestQuote(model, () => {\n      this.isSubmitted = true;\n    });\n  }\n\n}\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("em",{parentName:"p"},"checkout.component.html")," file is divided in 2 sections: ",(0,a.kt)("em",{parentName:"p"},"before the request is submitted")," and ",(0,a.kt)("em",{parentName:"p"},"after the request is submitted")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'<h3 *ngIf="configuration">Request quote <small>{{configuration.root.description}}</small></h3>\n\n<div *ngIf="!isSubmitted">\n\n  <form #checkoutForm="ngForm" (ngSubmit)="requestQuote(checkoutForm.value)">\n    <fieldset>\n      <legend>Request quote</legend>\n      <label>First name <input type="text" name="firstName" ngModel /></label>    \n      <label>Last name <input type="text" name="lastName" ngModel /></label>    \n      <label>Company name <input type="text" name="companyName" ngModel /></label>  \n      <label>Phone number <input type="text" name="phoneNumber" ngModel /></label>    \n      <label>Email <input type="email" name="email" ngModel /></label>    \n      <label>Street <input type="email" name="streetName" ngModel /></label>    \n      <label>Postal code <input type="email" name="postalCode" ngModel /></label>\n\n      <input type="submit" value="Submit" />\n    </fieldset>\n  </form>\n  \n</div>\n\n<div *ngIf="isSubmitted">\n  <h2>Thank you for your quotation request!</h2>\n</div>\n')),(0,a.kt)("h3",{id:"result"},"Result"),(0,a.kt)("p",null,(0,a.kt)("img",{alt:"Result",src:n(2797).Z})))}m.isMDXComponent=!0},2797:function(t,e,n){e.Z=n.p+"assets/images/configurator-result-513f60f95d169a9899866c31cfa6b762.gif"},7089:function(t,e,n){e.Z=n.p+"assets/images/configurator-2f2ec1662be8ecf7c1f0b995801d3c6b.PNG"},4156:function(t,e,n){e.Z=n.p+"assets/images/productoverview-7370634083810c0640594ece20b9f28c.PNG"}}]);